<!DOCTYPE html>
<html style="font-size: 16px;">
  <head>
        
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
        integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
        crossorigin=""/>
        <link rel="stylesheet" href="css_1/style.css">
        <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
        integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
        crossorigin=""></script>
        <link rel="stylesheet" href="css_1/leaflet.css" />
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
        integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
        crossorigin="anonymous"></script>

        <style type="text/css">
          html, body { margin: 0px; padding: 1; height: 100%; }
          #map  {
                  width: 800px;
                  height: 580px;
                  margin: 15px auto
                }
          
        </style>
        
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="GEOPORTAIL DES ACCIDENTS ROUTIERS AU MAROC (2019-2021)">
    <meta name="description" content="">
    <meta name="page_type" content="np-template-header-footer-from-plugin">
    <title>Carte des décès</title>
    <link rel="stylesheet" href="nicepage.css" media="screen">
<link rel="stylesheet" href="Carte-des-décès.css" media="screen">
    <script class="u-script" type="text/javascript" src="jquery.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="nicepage.js" defer=""></script>
    <meta name="generator" content="Nicepage 4.5.4, nicepage.com">
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
    
    
    
    <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": ""
}</script>
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="Carte des décès">
    <meta property="og:type" content="website">
  </head>
  <body class="u-body u-xl-mode"><header class=" u-header u-section-row-container" id="sec-abc8" data-animation-name="" data-animation-duration="0" data-animation-delay="0" data-animation-direction=""><div class="u-section-rows">
        <div class="u-gradient u-section-row u-section-row-1" id="sec-abf3">
          <div class="u-clearfix u-sheet u-sheet-1">
            <img class="u-align-left u-image u-image-default u-preserve-proportions u-image-1" src="images/iav.jfif" alt="" data-image-width="175" data-image-height="168">
            <img class="u-align-right u-image u-image-default u-image-2" src="images/esigt.jpg" alt="" data-image-width="525" data-image-height="523">
            <h1 class="u-align-center u-text u-text-1">GEOPORTAIL DES ACCIDENTS ROUTIERS AU MAROC (2019-2021)</h1>
          </div>
          
          
          
          
          
        </div>
        <div class="u-black u-section-row u-section-row-2" data-animation-name="" data-animation-duration="0" data-animation-delay="0" data-animation-direction="" id="sec-a351">
          <div class="u-align-left u-clearfix u-sheet u-valign-middle u-sheet-2">
            <nav class="u-menu u-menu-dropdown u-offcanvas u-menu-1">
              <div class="menu-collapse" style="font-size: 1.25rem; letter-spacing: 0px; font-weight: 700; text-transform: uppercase;">
                <a class="u-button-style u-custom-active-border-color u-custom-border u-custom-border-color u-custom-borders u-custom-hover-border-color u-custom-left-right-menu-spacing u-custom-padding-bottom u-custom-text-active-color u-custom-text-color u-custom-text-hover-color u-custom-top-bottom-menu-spacing u-nav-link" href="#" style="padding: 0px; font-size: calc(1em + 0.5px);">
                  <svg class="u-svg-link" viewBox="0 0 24 24"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svg-f881"></use></svg>
                  <svg class="u-svg-content" version="1.1" id="svg-f881" viewBox="0 0 16 16" x="0px" y="0px" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"><g><rect y="1" width="16" height="2"></rect><rect y="7" width="16" height="2"></rect><rect y="13" width="16" height="2"></rect>
</g></svg>
                </a>
              </div>
              <div class="u-custom-menu u-nav-container">
                <ul class="u-nav u-spacing-30 u-unstyled u-nav-1"><li class="u-nav-item"><a class="u-border-2 u-border-active-palette-1-base u-border-hover-palette-1-base u-border-no-left u-border-no-right u-border-no-top u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-1-base u-text-white" href="Accueil.html" style="padding: 10px 0px;">Accueil</a>
</li><li class="u-nav-item"><a class="u-border-2 u-border-active-palette-1-base u-border-hover-palette-1-base u-border-no-left u-border-no-right u-border-no-top u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-1-base u-text-white" style="padding: 10px 0px;">Cartes</a><div class="u-nav-popup"><ul class="u-h-spacing-20 u-nav u-unstyled u-v-spacing-10 u-nav-2"><li class="u-nav-item"><a class="u-button-style u-nav-link u-white" href="Carte-des-décès.html">Carte des décès</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-white" href="Carte-des-blessés-graves.html">Carte des blessés graves</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-white" href="Carte-des-blessés-légers.html">Carte des blessés légers</a>
</li></ul>
</div>
</li><li class="u-nav-item"><a class="u-border-2 u-border-active-palette-1-base u-border-hover-palette-1-base u-border-no-left u-border-no-right u-border-no-top u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-1-base u-text-white" href="Donnees.html" style="padding: 10px 0px;">Donnees</a>
</li><li class="u-nav-item"><a class="u-border-2 u-border-active-palette-1-base u-border-hover-palette-1-base u-border-no-left u-border-no-right u-border-no-top u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-1-base u-text-white" href="Contact.html" style="padding: 10px 0px;">Contact</a>
</li></ul>
              </div>
              <div class="u-custom-menu u-nav-container-collapse">
                <div class="u-black u-container-style u-inner-container-layout u-opacity u-opacity-95 u-sidenav">
                  <div class="u-inner-container-layout u-sidenav-overflow">
                    <div class="u-menu-close"></div>
                    <ul class="u-align-center u-nav u-popupmenu-items u-unstyled u-nav-3"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Accueil.html" style="padding: 10px 0px;">Accueil</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" style="padding: 10px 0px;">Cartes</a><div class="u-nav-popup"><ul class="u-h-spacing-20 u-nav u-unstyled u-v-spacing-10 u-nav-4"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Carte-des-décès.html">Carte des décès</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Carte-des-blessés-graves.html">Carte des blessés graves</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Carte-des-blessés-légers.html">Carte des blessés légers</a>
</li></ul>
</div>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Donnees.html" style="padding: 10px 0px;">Donnees</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Contact.html" style="padding: 10px 0px;">Contact</a>
</li></ul>
                  </div>
                </div>
                <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
              </div>
            </nav>
          </div>
          
          
          
          
          
        </div>
      </div></header>
    <section class="u-clearfix u-section-1" id="sec-a889">
      <div class="u-clearfix u-sheet u-valign-middle u-sheet-1"><span class="u-file-icon u-icon u-icon-1"><img src="images/854901.png" alt=""></span>
        <p class="u-align-center u-custom-font u-font-georgia u-text u-text-1"><span class="u-icon"></span>Carte avec symboles proportionnels de l'évolution des nombres de décès pour
les années 2019, 2020 et 2021 
        </p>
      </div>
    </section>

    <section>
    
        <div id="map"></div>
        <script type="text/javascript" src="js_1/regions.js"></script>
        <script type="text/javascript">
        $(document).ready(function() {
          var map = L.map('map', {
              center: [29, -5],
              zoom: 5
          });

          L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png', {
           attribution: 'Map tiles by Carto, under CC BY 3.0. Data by OpenStreetMap, under ODbL.',
           maxZoom: 11,
           minZoom: 4
         }).addTo(map);
          
          function Monstyle(feature) {
            return {
              weight: 2,
              opacity: 1,
              color: '#5a5e5f',
              dashArray: '3',
              fillOpacity: 0.8,
              fillColor: '#b3bcbe'
            };
          } 

          var geojson = L.geoJson(regions, {
            style: Monstyle}).addTo(map);

         //Upload Geojson File
         
      $.getJSON("https://raw.githubusercontent.com/rondinasia/symbole_proportionelles/main/accidents.geojson")
      .done(function(data) {
          var info = processData(data);
          createPropSymbols(info.timestamps, data);
          createLegend(info.min,info.max);
          createSliderUI(info.timestamps);
          
      });

        // Process Data
        function processData(data) {
          
          var timestamps = [];  
          var min = Infinity; 
          var max = -Infinity;

          
          for (var feature in data.features) {
              var properties = data.features[feature].properties;

              
              for (var attribute in properties) {
                  if ( attribute != 'FID_' &&
                       attribute != 'Id' &&
                       attribute != 'Nom' &&
                       attribute != 'Lat' &&
                       attribute != 'Lon' )   
                  {
                      if ( $.inArray(attribute,timestamps) ===  -1) { 
                                                        

                          timestamps.push(attribute);  
                      }
                      if (properties[attribute] < min) {
                          min = properties[attribute]; 
                      }
                      if (properties[attribute] > max) {
                          max = properties[attribute]; 
                      }
                  }
              }
          }
          return { 
              timestamps : timestamps,
              min : min,
              max : max
          }
        }

        // Create Propotional Symbols
        function createPropSymbols(timestamps, data) {

          regions = L.geoJson(data, {

              
              pointToLayer: function(feature, latlng) {
                  return L.circleMarker(latlng, { // we use circle marker for the points
                      fillColor: "#A30000",  // fill color of the circles
                      color: '#A30000',      // border color of the circles
                      weight: 3,             // circle line weight in pixels
                      fillOpacity: 0.5       // fill opacity (0-1)
                  }).on({
                        mouseover: function(e) {
                            this.openPopup();
                            this.setStyle({fillColor: 'black'});  // fill color turns black when mouseover
                        },
                        mouseout: function(e) {
                            this.closePopup();
                            this.setStyle({fillColor: '#A30000'});  // fill turns original color when mouseout
                        }
                });
              }
          }).addTo(map);

          updatePropSymbols(timestamps[0]); 
        }

        // Update Propotional Symbols
        function updatePropSymbols(timestamp) {

          regions.eachLayer(function(layer) {  

              var props = layer.feature.properties;  
              var radius = calcPropRadius(props[timestamp]); 

              var year = 2018 + parseInt(timestamp)
              var popupContent = '<b> Année : <b>' + year + '<b> <br /> Région : <b>' + props.Nom + '</b> <br />Total Des Décès : ' + String(props[timestamp]) ;

              layer.setRadius(radius);  
              layer.bindPopup(popupContent, { offset: new L.Point(0,-radius), autoPan: false }); 
          });
        }

        // change le rayon 
        function calcPropRadius(attributeValue) {

          var scaleFactor = 2;   
          var area = attributeValue * scaleFactor;

          return Math.sqrt(area/Math.PI);  
        }


        function createLegend(min, max) {
                if (min < 100) { 
                    min = 100; 
                }
                function roundNumber(inNumber) {
                     return (Math.round(inNumber/10) * 10);
                }
                var legend = L.control( { position: 'bottomright'} );    
                legend.onAdd = function(map) {

                var legendContainer = L.DomUtil.create("div", "legend");
                var symbolsContainer = L.DomUtil.create("div", "symbolsContainer");
                var classes = [roundNumber(min), roundNumber((max-min)/2), roundNumber(max)]; 
                var legendCircle;
                var lastRadius = 0;
                var currentRadius;
                var margin;
                L.DomEvent.disableClickPropagation(legendContainer);; 
                $(legendContainer).append("<h3 id='legendTitle'>Nombre des décès</h3>");

                for (var i = 0; i <= classes.length-1; i++) {

                    legendCircle = L.DomUtil.create("div", "legendCircle");
                    currentRadius = calcPropRadius(classes[i]);
                    margin = -currentRadius - lastRadius - 2;
                    $(legendCircle).attr("style", "width: " + currentRadius*2 +
                        "px; height: " + currentRadius*2 + 
                        "px; margin-left: " + margin + "px" );
                    $(legendCircle).append("<span       class='legendValue'>"+ classes[i] + '   '+ 'cas' +"</span>");
                    $(symbolsContainer).append(legendCircle);
                    lastRadius = currentRadius;
                }
                $(legendContainer).append(symbolsContainer);
                return legendContainer; 
                };
                legend.addTo(map);} // end createLegend() 



    // Creation of the Slider
    function createSliderUI(timestamps) {
      var sliderControl = L.control({ position: 'bottomleft'} ); 
      sliderControl.onAdd = function(map) {
        
          var slider = L.DomUtil.create("input", "range-slider");
          L.DomEvent.addListener(slider, 'mousedown', function(e) {
              L.DomEvent.stopPropagation(e);
          });

        var labels = ["2019", "2020","2021"];

        $(slider)
            .attr({
              'type':'range',
              'max': timestamps[timestamps.length-1],
              'min':timestamps[0],
              'step': 1, 
              'value': String(timestamps[0])})
            .on('input change', function() {
                updatePropSymbols($(this).val().toString()); 
                var i = $.inArray(this.value,timestamps);
                $(".temporal-legend").text(labels[i]); 
            });
        return slider;
      }
      sliderControl.addTo(map);
      createTimeLabel(timestamps); 
      }


      // Create a Legend for the Slider
      function createTimeLabel(startTimestamp) {
        var temporalLegend = L.control({position: 'bottomleft' }); 
        temporalLegend.onAdd = function(map) {
          var output = L.DomUtil.create("output", "temporal-legend");
          $(output).text(startTimestamp);
          return output;
        }
        temporalLegend.addTo(map);
      }




    });

        </script>
    </section>
    

    <section class="u-clearfix u-section-2" id="sec-98f0">
      <div class="u-clearfix u-sheet u-sheet-1"><span class="u-file-icon u-icon u-icon-1"><img src="images/2353678.png" alt=""></span>
        <p class="u-align-center u-custom-font u-font-georgia u-text u-text-custom-color-1 u-text-1"> Comment ça marche ?</p>
        <ol class="u-align-left u-custom-font u-font-georgia u-text u-text-2">
          <li>Glisser le slider en bas à droite de la carte pour naviguer entre les dates (2019-2020-2021). <br />NB: Par défaut c'est 2019.</li>
          <li>Mettre le curseur sur le cercle placé au centroide de la région afin d'afficher le nombre de décès relatif.&nbsp;<br>
          </li>
          <li>Zoomer/dézoomer à l’aide de l’outil situé dans le coin supérieur gauche de la carte.</li>
        </ol>
      </div>
    </section>
    
    
    <footer class="u-align-center u-black u-clearfix u-footer u-footer" id="sec-b117"><div class="u-clearfix u-sheet u-sheet-1">
        <p class="u-small-text u-text u-text-variant u-text-1"> PROJET DE WEB MAPPING 2021-2022</p>
      </div></footer>
    <section class="u-backlink u-clearfix u-grey-80">
      <a class="u-link" href="https://nicepage.com/website-templates" target="_blank">
        <span>Website Templates</span>
      </a>
      <p class="u-text">
        <span>created with</span>
      </p>
      <a class="u-link" href="" target="_blank">
        <span>Website Builder Software</span>
      </a>. 
    </section>
  </body>
</html>